## EasyBaaS使用文档

在完成《README.md》中的“项目部署”步骤以后可直接通过主机的8080端口访问EasyBaaS，从主导方获取到配置文件部署节点后可通过3000端口访问节点监控页面。

### 1.1 登录

访问**主机地址:8080**即跳转EasyBaaS登录页面，默认用户密码为：admin/adminpw

### 1.2 部署节点

* 路径：节点管理->节点部署
* 功能描述：linux主机上部署区块链节点（部署节点之前需要获取到联盟链主导方提供的节点配置文件，如: 开放许可链需要获得mba-mainnet.zip）。
* 参数说明：
  * 节点部署IP：EasyBaaS主机可以连通的linux主机IP地址，建议在部署前进行连通性测试；若资源紧张或EasyBaaS主机配置较好，则可以直接在EasyBaaS主机上部署。
  * 节点名称：部署节点的名称，可以根据需要进行自定义。
  * 配置文件：联盟链主导方提供的压缩包文件。
  * 节点私钥：压缩包文件解压以后privkey文件的内容。
  * 节点地址：压缩包文件解压以后address文件的内容。
  * 账号(弹框)：可访问节点文件路径的linux用户名。
  * 密码(弹框)：可访问节点文件路径的linux用户密码。
* 注：账号默认设定为userClient，对应密码在脚本部署环境时生成；如果无法使用，则会弹出提示框，此时用户可以使用自己服务器上的其它账号密码来传输配置文件。

### 1.3 已有节点纳管

- 路径：节点管理->已有节点纳管
- 功能描述：将Bin方式部署的现有节点纳管到客户端进行管理。
- 参数说明：
  - 节点部署IP：EasyBaaS主机可以连通的linux主机IP地址，建议在部署前进行连通性测试。
  - 节点名称：部署节点的名称。
  - 节点文件路径：已经部署到网络层面的节点文件路径，例如：/root/mba-testnet。
  - 账号(弹框)：可访问节点文件路径的linux用户名。
  - 密码(弹框)：可访问节点文件路径的linux用户密码。
- 注：账号默认设定为userClient，对应密码在脚本部署环境时生成；如果无法使用，则会弹出提示框，此时用户可以使用自己服务器上的其它账号密码来传输配置文件。

### 1.4 节点基本信息

* 路径：节点管理->节点维护

* 功能描述：

  节点名称、节点部署主机IP、节点版本、节点运行状态等基本信息展示，其中节点运行状态为节点的进程检查，任何进程异常均会显示为异常状态，一般重启即可。

### 1.5 节点启停

* 路径：节点管理->节点维护

* 功能描述：

  节点部署后，节点处于<font color='green'>**运行中**</font>状态。此时您可以点击**停止**按钮停止节点；当节点状态为<font color='red'>**已停止**</font>时，您可以点击**启动**按钮启动节点。

### 1.6 节点重启

- 路径：节点管理->节点维护

- 功能描述：

  节点部署后，节点处于<font color='green'>**运行中**</font>状态，但当节点指示为**警告**时，可点击**重启**按钮重启节点。

### 1.7 节点升级

- 路径：节点管理->节点维护

- 功能描述：

  节点部署后，当需要升级新版本时，由联盟链主导方提供配置文件和升级镜像，您只需重新启动客户端，点击**升级**进行节点升级。

### 1.8 节点日志查看

* 路径：节点管理->节点维护

* 功能描述：

  可以点击**日志**按钮查看最新的100条日志，实时查看最新状态。

### 1.9 开启trace日志

- 路径：节点管理->节点维护

- 功能描述：

  打开节点trace级别日志，获取更多日志信息。

### 1.10 清理日志

- 路径：节点管理->节点维护

- 功能描述：

  清理节点产生的日志，释放空间。

### 1.11 监控服务

* 路径：监控服务->监控维护

* 功能描述：

    监控维护页面显示了监控组件，如有不在<font color='green'>**运行中**</font>状态的可以通过**启动**按钮重启。同时，您可以通过<font color='#1890ff'>**监控查看**</font>按钮跳转至EasyBaaS主机3000端口查看监控详情。跳转后，左侧栏选择**Dashboards->CITA Node Info Dashboard**可查看节点监控详情。监控项主要包括：链名、链创建时间、链共识节点数、链运行时间、当前节点区块链高度、区块高度历史曲线图等指标。

### 1.12 告警配置

- 路径：监控服务->告警配置

- 功能描述：

  配置告警服务发送邮箱和告警人列表，当告警条件被触发时，邮件将被发送到告警人邮箱。

------------------------------------------------------------------------------------------------------

### 重点注意事项

1. 目前的版本适用于CITA网络搭建，支持CITA国际和国密，开启TLS、关闭TLS。
2. 在节点部署过程中，必须确认联盟链主导方提供正确的配置文件，否则操作会出现问题。
3. 只支持在一台服务器上部署一个节点，如果您想部署多个节点，需要使用多台服务器。
4. docker和jdk需使用root权限安装，userClient用户默认添加到docker组，如您希望其他用户访问docker内容，请将用户添加到docker组。
5. 部署脚本执行前请关闭占用2375端口的程序，如是已有docker程序占用则不用关闭。
6. EasyBaaS部署的服务器需使用3000、9090、9093端口来提供监控服务，部署前请检查端口是否被占用。
7. 节点部署服务器需使用9256、8899、1920、9100、9419端口来支持监控服务，使用1337,4000端口支持区块链节点，部署前检查端口是否被占用。(如果CITA网络和客户端部署的节点使用同一台机器，则不能运行，需要在两台机器运行)
8. EasyBaaS部署节点过程中，需要使用telnet命令检查网络连通性，并使用sftp服务连接节点服务器上传配置文件，请提前安装telnet命令并开启sftp权限。
9. 部署脚本会启动系统自带的firewall防火墙，如不需要，可自行关闭。
10. 脚本启动后，需要输入EasyBaaS运行的端口号，请提前检查该端口号是否被占用。

-------------------------------------------------------------------------------------------------------

**附：**

#### 1、 脚本功能说明

| 序号 | 功能                                    | 说明                                                         |
| ---- | -------------------------------------- | ------------------------------------------------------------ |
| 1    | 部署docker以及java运行环境               | 安装docker和java环境、导入镜像、telnet命令检测、创建用户，适用于节点部署服务器。 |
| 2    | 部署docker环境                          | 安装docker环境、导入镜像、telnet命令检测、创建用户       |
| 3    | 部署java环境                            | 安装java环境、telnet命令检测、创建用户         |
| 4    | 运行EasyBaaS                            | 导入镜像、telnet命令检测、创建用户、获取Jar运行端口、启动客户端，适用于环境已符合要求，运行EasyBaaS的情况。|
| 5    | 创建用户                                | 创建用户                                                     |
| 6    | 退出                                    |                                                              |

#### 2、部署脚本sh文件使用说明

1. 文件请按《README.md》中1.2中所示层级进行放置。

2. 请使用source install-client.sh 来执行文件，执行退出后会断开连接，需要重新连接一次，以保证安装环境后能读取到环境变量。

3. 执行install-client.sh时，选择除退出外的任一项都会创建userClient用户，用户userClient的登录密码会在日志中打印出来，请注意查看。

4. 运行EasyBaaS后，会将jar文件、镜像文件拷贝到/home/userClient目录下面执行。

   注：后续的操作会基于此用户进行执行

#### 3、 EasyBaaS　jar文件使用说明

1. 执行install-client.sh脚本文件部署EasyBaaS后，将在/home/userClient目录下创建db数据文件与log文件夹，在log文件夹中可以查看日志情况。
2. jar启动后会在log文件中打印访问地址和账号密码。
3. 若客户端进程异常中止，可到/home/userClient目录下执行nohup java -jar EasyBaaS-1.0.0.jar  >log/log.txt 2>&1 &命令启动客户端。
